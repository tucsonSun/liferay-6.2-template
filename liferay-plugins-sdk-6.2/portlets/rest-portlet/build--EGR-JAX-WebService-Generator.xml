<?xml version="1.0"?>
<!DOCTYPE project>
<project name="EGR-JAX-WebService-Generator" default="help">

	<property name="wsdl" value="http://www.webservicex.com/globalweather.asmx?wsdl" />
	<property name="package" value="com.egr.external.ws.globalweather" />
	<property name="javac.srcdir" value="docroot/WEB-INF/src/com/egr/external/ws/globalweather" />
	<property name="jarName.and.path" value="docroot/WEB-INF/lib/bundled-API-webServices-globalWeather.jar" />
	<property name="compiled.classes.temp.dir" value="webService_dist" />
	
	<property name="src" value="docroot/WEB-INF/src" />
	<property name="classes" value="docroot/WEB-INF/classes" />
	<!-- Windows path -->
	<property name="jdk.windows.home" value="C:/Program Files/Java/jdk1.7.0_67" />
	<!-- Linux path -->
	<property name="jdk.linux.home" value="/usr/lib/jvm/java-7-openjdk-amd64" />

	<tstamp>
		<format property="time.stamp" pattern="yyyy-MM-dd_HH:mm:ss"/>
	</tstamp>

	<condition property="isWindows">
		<os family="windows" />
	</condition>

	<condition property="isUnix">
		<os family="unix" />
	</condition>


	<target name="help">
		<echo message="This is a simple Ant script that is used to generate the required" />
		<echo message="Java class files associated with a WSDL. It uses the JAX-WS tool" />
		<echo message="wsimport that is supplied with the JDK." />
	</target>

	<target name="setWindowsPaths" if="isWindows">
		<echo message="Ant detected that OS isWindows= ${isWindows}" />
		<property name="jdk.home" value="${jdk.windows.home}" />
	</target>

	<target name="setUnixPaths" if="isUnix">
		<echo message="Ant detected that OS isLinux= ${isUnix}" />
		<property name="jdk.home" value="${jdk.linux.home}" />
	</target>

	<!-- ********************** -->
	<!-- Main Target used to generate the Java WebServcies Classes -->
	<!-- ********************** -->
	<target name="generate-and-deploy-webService-bundle-jar" description="target will generate Java classes from a specifed WSDL using JAX-WS" depends="setWindowsPaths, setUnixPaths">		
		<antcall target="create-webService-java-package"></antcall>
		<antcall target="compile-webService-java"></antcall>
		<antcall target="create-bundled-webService-jar"></antcall>
		<antcall target="delete-classes-dir"></antcall>
		<antcall target="delete-java-package-dir"></antcall>
	</target>


	<target name="create-webService-java-package">
		<echo message="jdk.home = '${jdk.home}'" />
		<echo message="wsdl = '${wsdl}'" />
		<echo message="package = '${package}'" />
		<echo message="src = '${src}'" />
		<echo message="classes = '${classes}'" />

		<exec executable="${jdk.home}/bin/wsimport">
			<arg line="-keep -s ${src} -p ${package} -d ${classes} ${wsdl} -B-XautoNameResolution" />
		</exec>
	</target>


	<target name="compile-webService-java">
		<property name="javac.debug" value="false" />
		<echo message="jdk.home = '${jdk.home}'" />
		<echo message="destination of compiled files into compiled.classes.temp.dir= '${compiled.classes.temp.dir}'" />
		<echo message="source of java files into javac.srcdir= '${javac.srcdir}'" />

		<mkdir dir="${compiled.classes.temp.dir}" />
		
		<javac
			fork="yes"
			executable="${jdk.home}/bin/javac"
			includeantruntime="false"
			debug="${javac.debug}"
			destdir="${compiled.classes.temp.dir}"
			srcdir="${javac.srcdir}"
		/>
		
	</target>


	<target name="create-bundled-webService-jar">
		<echo message="compiled.classes.temp.dir = '${compiled.classes.temp.dir}'" />
		<echo message="jarName.and.path = '${jarName.and.path}'" />
		
		<jar basedir="${compiled.classes.temp.dir}" destfile="${jarName.and.path}">
			<manifest>
				<attribute name="Built-By" value="auto generated by ant tools" />
				<!-- <attribute name="Built-On" value="${time.stamp}" /> -->
			</manifest>
		</jar>
	</target>

	
	<target name="delete-classes-dir">
		<echo message="delete files in = '${compiled.classes.temp.dir}'" />
		<delete includeemptydirs="true" verbose="true">
		    <fileset dir="${compiled.classes.temp.dir}" defaultexcludes="false">
		    </fileset>
		</delete>
	</target>
	
	
	<target name="delete-java-package-dir">
		<echo message="delete files in = '${javac.srcdir}'" />
		<delete includeemptydirs="true" verbose="true">
		    <fileset dir="${javac.srcdir}" defaultexcludes="false">
		    </fileset>
		</delete>
	</target>
	
		
	
	
</project>
